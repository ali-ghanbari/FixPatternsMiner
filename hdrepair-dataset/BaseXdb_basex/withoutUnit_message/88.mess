Bug fix: rewriting location steps with predicates


fix bug in geometry computation on hops


Added some test coverage for the various ways exceptions can fail to serialize, plus fixed the case where getStacktrace() fails with an exception.


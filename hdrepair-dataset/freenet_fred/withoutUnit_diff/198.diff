diff --git a/src/freenet/support/io/PersistentBlobTempBucketFactory.java b/src/freenet/support/io/PersistentBlobTempBucketFactory.java
index db80e4c..5fd4435 100644
--- a/src/freenet/support/io/PersistentBlobTempBucketFactory.java
+++ b/src/freenet/support/io/PersistentBlobTempBucketFactory.java
@@ -192 +192 @@
-			if(tag.index > blocks) {
+			if(tag.index >= freeBlocksCache.getSize()) {


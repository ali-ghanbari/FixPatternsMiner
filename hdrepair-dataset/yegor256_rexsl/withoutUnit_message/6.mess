fixes and closes #667


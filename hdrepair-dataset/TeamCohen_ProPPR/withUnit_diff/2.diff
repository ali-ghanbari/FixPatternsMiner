diff --git a/src/edu/cmu/ml/praprolog/prove/SparseMatrixIndex.java b/src/edu/cmu/ml/praprolog/prove/SparseMatrixIndex.java
index e0eaec0..daba8a3 100644
--- a/src/edu/cmu/ml/praprolog/prove/SparseMatrixIndex.java
+++ b/src/edu/cmu/ml/praprolog/prove/SparseMatrixIndex.java
@@ -155 +155 @@
-		if (r!=null) {
+		if (r==null) {
diff --git a/test/edu/cmu/ml/praprolog/prove/SparseGraphComponentTest.java b/test/edu/cmu/ml/praprolog/prove/SparseGraphComponentTest.java
new file mode 100644
index 0000000..9a98b74
--- /dev/null
+++ b/test/edu/cmu/ml/praprolog/prove/SparseGraphComponentTest.java
@@ -0,0 +1,16 @@
+package edu.cmu.ml.praprolog.prove;
+
+import static org.junit.Assert.*;
+
+import org.junit.Test;
+
+public class SparseGraphComponentTest {
+
+	@Test
+	public void testDegree() {
+		SparseGraphComponent c = SparseGraphComponent.load("testcases/sparseGraph/family.sparse");
+		ProPPRLogicProgramState s = new ProPPRLogicProgramState(Goal.decompile("child,pam,-1"));
+		assertEquals(3,c.degree(s));
+	}
+
+}
diff --git a/testcases/sparseGraph/child_per_per.cfacts b/testcases/sparseGraph/child_per_per.cfacts
new file mode 100644
index 0000000..7f269a3
--- /dev/null
+++ b/testcases/sparseGraph/child_per_per.cfacts
@@ -0,0 +1,18 @@
+child	pam	katie
+child	pam	ashley
+child	pam	teddy
+child	susan	david
+child	susan	jenny
+child	dot	paul
+child	dot	mark
+child	theresa	taylor
+child	theresa	nick
+child	jeanine	brian
+child	jeanine	andrew
+child	jeanine	matt
+child	yvette	marcel
+child	yvette	theresa
+child	yvette	jeanine
+child	bette	pam
+child	bette	susan
+child	bette	jeff
\ No newline at end of file
diff --git a/testcases/sparseGraph/family.sparse/child_per_per.colIndex b/testcases/sparseGraph/family.sparse/child_per_per.colIndex
new file mode 100644
index 0000000..006d09e
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/child_per_per.colIndex
@@ -0,0 +1,18 @@
+12
+19
+22
+16
+20
+0
+17
+3
+1
+14
+24
+13
+6
+18
+23
+11
+15
+25
diff --git a/testcases/sparseGraph/family.sparse/child_per_per.rce b/testcases/sparseGraph/family.sparse/child_per_per.rce
new file mode 100644
index 0000000..830108a
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/child_per_per.rce
@@ -0,0 +1,3 @@
+27
+27
+18
diff --git a/testcases/sparseGraph/family.sparse/child_per_per.rowOffset b/testcases/sparseGraph/family.sparse/child_per_per.rowOffset
new file mode 100644
index 0000000..c86e3a5
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/child_per_per.rowOffset
@@ -0,0 +1,27 @@
+0
+0
+0
+3
+3
+3
+3
+3
+3
+5
+5
+5
+8
+8
+8
+8
+8
+8
+8
+8
+11
+11
+11
+13
+13
+13
+15
diff --git a/testcases/sparseGraph/family.sparse/per.i b/testcases/sparseGraph/family.sparse/per.i
new file mode 100644
index 0000000..2aef98d
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/per.i
@@ -0,0 +1,27 @@
+andrew
+ashley
+bette
+brian
+dan
+dave
+david
+don
+dot
+george
+henri
+jeanine
+jeff
+jenny
+katie
+marcel
+mark
+matt
+nick
+pam
+paul
+roy
+susan
+taylor
+teddy
+theresa
+yvette
diff --git a/testcases/sparseGraph/family.sparse/sister_per_per.colIndex b/testcases/sparseGraph/family.sparse/sister_per_per.colIndex
new file mode 100644
index 0000000..73be3b1
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/sister_per_per.colIndex
@@ -0,0 +1,11 @@
+14
+13
+25
+1
+11
+25
+22
+19
+1
+14
+11
diff --git a/testcases/sparseGraph/family.sparse/sister_per_per.rce b/testcases/sparseGraph/family.sparse/sister_per_per.rce
new file mode 100644
index 0000000..98d7c95
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/sister_per_per.rce
@@ -0,0 +1,3 @@
+26
+27
+11
diff --git a/testcases/sparseGraph/family.sparse/sister_per_per.rowOffset b/testcases/sparseGraph/family.sparse/sister_per_per.rowOffset
new file mode 100644
index 0000000..b763ea3
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/sister_per_per.rowOffset
@@ -0,0 +1,26 @@
+0
+0
+1
+1
+1
+1
+1
+2
+2
+2
+2
+2
+3
+3
+3
+4
+6
+6
+6
+6
+7
+7
+7
+8
+8
+10
diff --git a/testcases/sparseGraph/family.sparse/sparseIndex.txt b/testcases/sparseGraph/family.sparse/sparseIndex.txt
new file mode 100644
index 0000000..08877fd
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/sparseIndex.txt
@@ -0,0 +1,3 @@
+sister_per_per
+spouse_per_per
+child_per_per
diff --git a/testcases/sparseGraph/family.sparse/spouse_per_per.colIndex b/testcases/sparseGraph/family.sparse/spouse_per_per.colIndex
new file mode 100644
index 0000000..77a48d0
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/spouse_per_per.colIndex
@@ -0,0 +1,16 @@
+21
+25
+11
+22
+9
+8
+26
+5
+20
+19
+15
+14
+2
+7
+4
+10
diff --git a/testcases/sparseGraph/family.sparse/spouse_per_per.rce b/testcases/sparseGraph/family.sparse/spouse_per_per.rce
new file mode 100644
index 0000000..d82376f
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/spouse_per_per.rce
@@ -0,0 +1,3 @@
+27
+27
+16
diff --git a/testcases/sparseGraph/family.sparse/spouse_per_per.rowOffset b/testcases/sparseGraph/family.sparse/spouse_per_per.rowOffset
new file mode 100644
index 0000000..83a9d67
--- /dev/null
+++ b/testcases/sparseGraph/family.sparse/spouse_per_per.rowOffset
@@ -0,0 +1,27 @@
+0
+0
+0
+1
+1
+2
+3
+3
+4
+5
+6
+7
+8
+8
+8
+9
+10
+10
+10
+10
+11
+12
+13
+14
+14
+14
+15
diff --git a/testcases/sparseGraph/sister_per_per.cfacts b/testcases/sparseGraph/sister_per_per.cfacts
new file mode 100644
index 0000000..3d6fa78
--- /dev/null
+++ b/testcases/sparseGraph/sister_per_per.cfacts
@@ -0,0 +1,11 @@
+sister	katie	ashley
+sister	ashley	katie
+sister	teddy	ashley
+sister	teddy	katie
+sister	pam	susan
+sister	susan	pam
+sister	marcel	theresa
+sister	marcel	jeanine
+sister	theresa	jeanine
+sister	jeanine	theresa
+sister	david	jenny
\ No newline at end of file
diff --git a/testcases/sparseGraph/spouse_per_per.cfacts b/testcases/sparseGraph/spouse_per_per.cfacts
new file mode 100644
index 0000000..88336c5
--- /dev/null
+++ b/testcases/sparseGraph/spouse_per_per.cfacts
@@ -0,0 +1,16 @@
+spouse	marcel	pam
+spouse	pam	marcel
+spouse	katie	paul
+spouse	paul	katie
+spouse	george	dot
+spouse	dot	george
+spouse	theresa	dan
+spouse	dan	theresa
+spouse	jeanine	dave
+spouse	dave	jeanine
+spouse	susan	don
+spouse	don	susan
+spouse	yvette	henri
+spouse	henri	yvette
+spouse	bette	roy
+spouse	roy	bette
\ No newline at end of file


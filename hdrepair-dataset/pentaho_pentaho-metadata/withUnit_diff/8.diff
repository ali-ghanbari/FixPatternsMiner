diff --git a/src/org/pentaho/pms/mql/PMSFormula.java b/src/org/pentaho/pms/mql/PMSFormula.java
index 166b9b1..11e1bbc 100644
--- a/src/org/pentaho/pms/mql/PMSFormula.java
+++ b/src/org/pentaho/pms/mql/PMSFormula.java
@@ -584 +584 @@
-          tableAlias = tableAliases.get(businessTable.getId());
+          tableAlias = tableAliases.get(businessTable);
diff --git a/test/org/pentaho/pms/MQLQueryImplTest.java b/test/org/pentaho/pms/MQLQueryImplTest.java
index c2fd9c8..c5fa5fe 100644
--- a/test/org/pentaho/pms/MQLQueryImplTest.java
+++ b/test/org/pentaho/pms/MQLQueryImplTest.java
@@ -1638 +1638,2 @@
-    bc5.setFormula("pc5"); //$NON-NLS-1$
+    // bc5.setFormula("pc5"); //$NON-NLS-1$
+    bc5.setFormula("pc5");
@@ -1641,0 +1643,11 @@
+
+    final BusinessColumn bc6 = new BusinessColumn();
+    bc6.setId("bc6"); //$NON-NLS-1$
+    // bc5.setFormula("pc5"); //$NON-NLS-1$
+    bc6.setExact(true);
+    bc6.setFormula("SUM([pc5]*2)");
+    bc6.setAggregationType(AggregationSettings.SUM);
+    bc6.setBusinessTable(bt5);
+    bt5.addBusinessColumn(bc6);
+    bt5.setRelativeSize(1);
+
@@ -1711,0 +1724,26 @@
+
+    //
+    // This tests the physical column aliasing
+    //
+    
+    myTest = new MQLQueryImpl(null, model, databaseMeta, "en_US"); //$NON-NLS-1$
+    myTest.addSelection(new Selection(bc4));
+    myTest.addSelection(new Selection(bc6));
+    
+    query = myTest.getQuery();
+
+    assertEqualsIgnoreWhitespaces( 
+          "SELECT \n" 
+        + "             metadata_business_table_very01.pc4 AS COL0 \n"
+        + "           , SUM( metadata_business_table_very02.pc5  * 2) AS COL1 \n"
+        + "FROM \n" 
+        + "             pt4 metadata_business_table_very01 \n" 
+        + "            ,pt5 metadata_business_table_very02 \n"
+        + "WHERE \n"
+        + "             (\n" 
+        + "                metadata_business_table_very01.pc4 = metadata_business_table_very02.pc5 "
+    		+ "             )\n" 
+        + "GROUP BY \n"  
+        + "             metadata_business_table_very01.pc4 \n",
+        query.getQuery()    
+    );


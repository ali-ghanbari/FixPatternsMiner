diff --git a/src/main/org/hornetq/core/remoting/impl/ChannelImpl.java b/src/main/org/hornetq/core/remoting/impl/ChannelImpl.java
index 395eea5..f54fdc8 100644
--- a/src/main/org/hornetq/core/remoting/impl/ChannelImpl.java
+++ b/src/main/org/hornetq/core/remoting/impl/ChannelImpl.java
@@ -350 +350 @@
-         sendSemaphore.release(Integer.MAX_VALUE);
+         sendSemaphore.release(Integer.MAX_VALUE - sendSemaphore.availablePermits());
diff --git a/tests/src/org/hornetq/tests/integration/cluster/reattach/ReattachTest.java b/tests/src/org/hornetq/tests/integration/cluster/reattach/ReattachTest.java
index bcd9f69..7f8d8e8 100644
--- a/tests/src/org/hornetq/tests/integration/cluster/reattach/ReattachTest.java
+++ b/tests/src/org/hornetq/tests/integration/cluster/reattach/ReattachTest.java
@@ -418,0 +419,2 @@
+      log.info("Failing connection");
+      


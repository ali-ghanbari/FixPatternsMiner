added test class for Metadata transfer + fix silly bug in depth tracking


diff --git a/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java b/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
index b1fe456..4da5b7c 100644
--- a/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
+++ b/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
@@ -200 +200 @@
-                if (data.hasRemaining() && !plain.hasRemaining()) {
+                if (engine != null && data.hasRemaining() && !plain.hasRemaining()) {


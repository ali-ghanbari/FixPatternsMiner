diff --git a/activemq-broker/src/main/java/org/apache/activemq/store/SharedFileLocker.java b/activemq-broker/src/main/java/org/apache/activemq/store/SharedFileLocker.java
index 66c70e2..36ebe62 100644
--- a/activemq-broker/src/main/java/org/apache/activemq/store/SharedFileLocker.java
+++ b/activemq-broker/src/main/java/org/apache/activemq/store/SharedFileLocker.java
@@ -47 +47 @@
-            lockFile = new LockFile(lockFileName, true);
+            lockFile = new LockFile(lockFileName, false);
diff --git a/activemq-unit-tests/src/test/java/org/apache/activemq/store/SharedFileLockerTest.java b/activemq-unit-tests/src/test/java/org/apache/activemq/store/SharedFileLockerTest.java
index 623443f..ba768c0 100644
--- a/activemq-unit-tests/src/test/java/org/apache/activemq/store/SharedFileLockerTest.java
+++ b/activemq-unit-tests/src/test/java/org/apache/activemq/store/SharedFileLockerTest.java
@@ -48,0 +49,12 @@
+   public void testLoop() throws Exception
+   {
+      // Increase the number of iterations if you are debugging races
+      for (int i = 0 ; i < 100; i++)
+      {
+         internalLoop(5);
+      }
+
+   }
+
+
+   @Test
@@ -49,0 +62,7 @@
+   {
+      // using a bigger wait here
+      // to make sure we won't log any extra info
+      internalLoop(100);
+   }
+
+   private void internalLoop(long timewait) throws Exception
@@ -79,2 +97,0 @@
-         Thread.sleep(10);
-
@@ -98,2 +115,15 @@
-         // Waiting some small time here, you shouldn't see many messages
-         Thread.sleep(100);
+         // I need to make sure the info was already logged
+         // but I don't want to have an unecessary wait here,
+         // as I want the test to run as fast as possible
+         {
+            long timeout = System.currentTimeMillis() + 5000;
+            while (logCounts.get() < 1 && System.currentTimeMillis() < timeout)
+            {
+               Thread.sleep(1);
+            }
+         }
+
+         if (timewait > 0)
+         {
+            Thread.sleep(timewait);
+         }


fixing #196 (left/right_token calculation does not work with multiple components)


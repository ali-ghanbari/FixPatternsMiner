DF#QCADOOMES-443 refactoring, fixed NPE


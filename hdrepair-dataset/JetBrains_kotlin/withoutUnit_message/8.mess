simplify code, fix test, use CompletionUtil.findIdentifierPrefix()


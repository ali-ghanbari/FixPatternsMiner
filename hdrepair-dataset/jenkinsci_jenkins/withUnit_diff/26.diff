diff --git a/maven-plugin/src/main/java/hudson/maven/MavenBuild.java b/maven-plugin/src/main/java/hudson/maven/MavenBuild.java
index 4788033..bd30ba0 100644
--- a/maven-plugin/src/main/java/hudson/maven/MavenBuild.java
+++ b/maven-plugin/src/main/java/hudson/maven/MavenBuild.java
@@ -481 +481 @@
-            return wsl.allocate(getParentBuild().getModuleRoot().child(getProject().getRelativePath()));
+            return wsl.allocate(getModuleSetBuild().getModuleRoot().child(getProject().getRelativePath()));
diff --git a/test/pom.xml b/test/pom.xml
index 4999043..4b6655e 100644
--- a/test/pom.xml
+++ b/test/pom.xml
@@ -45,2 +45 @@
-          <!-- override with -DforkMode=pertest if you have "unable to create thread problems" on Windows
--->
+          <!-- override with -DforkMode=pertest if you have "unable to create thread problems" on Windows -->
@@ -53,2 +52 @@
-              <!-- use AntClassLoader that supports predictable file handle release
--->
+              <!-- use AntClassLoader that supports predictable file handle release -->
@@ -112,0 +111,5 @@
+      <groupId>org.jvnet.hudson.plugins</groupId>
+      <artifactId>subversion</artifactId>
+      <version>1.7</version>
+    </dependency>
+    <dependency>
diff --git a/test/src/test/java/hudson/maven/MavenBuildTest.java b/test/src/test/java/hudson/maven/MavenBuildTest.java
index e5e0538..a777ebb 100644
--- a/test/src/test/java/hudson/maven/MavenBuildTest.java
+++ b/test/src/test/java/hudson/maven/MavenBuildTest.java
@@ -6,0 +7 @@
+import hudson.scm.SubversionSCM;
@@ -36 +37 @@
-	m.setGoals("clean install findbugs:findbugs");
+        m.setGoals("clean install findbugs:findbugs");
@@ -47 +48 @@
-	m.setGoals("clean install");
+        m.setGoals("clean install");
@@ -59,0 +61,16 @@
+
+    /**
+     * Workspace determination problem on non-aggregator style build.
+     */
+    @Bug(4226)
+    public void testParallelModuleBuild() throws Exception {
+        configureDefaultMaven();
+        MavenModuleSet m = createMavenProject();
+        m.setScm(new SubversionSCM("https://www.dev.java.net/svn/hudson/trunk/hudson/test-projects/multimodule-maven"));
+        m.setAggregatorStyleBuild(false);
+
+        assertBuildStatusSuccess(m.scheduleBuild2(0).get());
+        // run module builds
+        assertBuildStatusSuccess(m.getModule("test$module1").scheduleBuild2(0).get());
+        assertBuildStatusSuccess(m.getModule("test$module1").scheduleBuild2(0).get());
+    }


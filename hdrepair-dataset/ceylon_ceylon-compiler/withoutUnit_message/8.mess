Extended fix for #1937 with support for switch expressions


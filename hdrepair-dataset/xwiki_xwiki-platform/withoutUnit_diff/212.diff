diff --git a/xwiki-core/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java b/xwiki-core/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java
index d542053..facde75 100644
--- a/xwiki-core/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java
+++ b/xwiki-core/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java
@@ -844 +844 @@
-        if (archive == null) {
+        if (archive == null || archive.get() == null) {


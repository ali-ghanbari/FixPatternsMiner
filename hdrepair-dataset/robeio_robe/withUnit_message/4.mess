ROBE-218 refactoring and JSON   test fix


diff --git a/hibernate-search/src/main/java/org/hibernate/search/spi/SearchFactoryBuilder.java b/hibernate-search/src/main/java/org/hibernate/search/spi/SearchFactoryBuilder.java
index 0856037..fd42be6 100644
--- a/hibernate-search/src/main/java/org/hibernate/search/spi/SearchFactoryBuilder.java
+++ b/hibernate-search/src/main/java/org/hibernate/search/spi/SearchFactoryBuilder.java
@@ -221,0 +222 @@
+		factoryState.setActiveSearchFactory( factory );
diff --git a/hibernate-search/src/test/java/org/hibernate/search/test/configuration/mutablefactory/MutableFactoryTest.java b/hibernate-search/src/test/java/org/hibernate/search/test/configuration/mutablefactory/MutableFactoryTest.java
index dfb4b78..df66b54 100644
--- a/hibernate-search/src/test/java/org/hibernate/search/test/configuration/mutablefactory/MutableFactoryTest.java
+++ b/hibernate-search/src/test/java/org/hibernate/search/test/configuration/mutablefactory/MutableFactoryTest.java
@@ -60 +60,4 @@
-import static org.junit.Assert.*;
+import static org.hibernate.search.test.SearchTestCase.getTargetLuceneVersion;
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertNotNull;
@@ -71 +74 @@
-		final ManualConfiguration configuration = new ManualConfiguration();
+		final ManualConfiguration configuration = getTestConfiguration();
@@ -78,2 +81 @@
-		ManualConfiguration configuration = new ManualConfiguration()
-				.addProperty( "hibernate.search.default.directory_provider", "ram" );
+		ManualConfiguration configuration = getTestConfiguration();
@@ -96 +97,0 @@
-		//we know there is only one DP
@@ -130,2 +131 @@
-		ManualConfiguration configuration = new ManualConfiguration()
-				.addProperty( "hibernate.search.default.directory_provider", "ram" );
+		ManualConfiguration configuration = getTestConfiguration();
@@ -192,3 +192 @@
-		ManualConfiguration configuration = new ManualConfiguration()
-				//We need to check that properties aren't lost: avoid fs as it's the default configuration
-				.addProperty( "hibernate.search.default.directory_provider", "ram" );
+		ManualConfiguration configuration = getTestConfiguration();
@@ -312,0 +311,7 @@
+
+	private static ManualConfiguration getTestConfiguration() {
+		return new ManualConfiguration()
+			.addProperty( "hibernate.search.default.directory_provider", "ram" )
+			.addProperty( "hibernate.search.lucene_version", getTargetLuceneVersion().name() );
+	}
+


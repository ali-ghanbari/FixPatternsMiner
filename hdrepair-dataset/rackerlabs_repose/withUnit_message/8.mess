Add unit test and fix MediaType bug.


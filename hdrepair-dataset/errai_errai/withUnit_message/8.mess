Add test for topo sort; fix bugs in initial implementation.


fixed a latent bug not related to this refactoring


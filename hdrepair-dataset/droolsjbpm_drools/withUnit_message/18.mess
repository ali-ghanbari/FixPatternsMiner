BZ-876760: Backporting fix from commit d6c502361faba12f0ca06af5dc5ae54deb1c6ff3 and adding test case.
(cherry picked from commit e2ce621476c14ce177f6279754d4534dff393304)


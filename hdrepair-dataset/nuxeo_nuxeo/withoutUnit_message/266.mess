NXP-7670: fix NPE and logic problem


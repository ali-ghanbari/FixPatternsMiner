diff --git a/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/InstancePrinter.xtend b/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/InstancePrinter.xtend
index 4e7fdbc..5f647dd 100644
--- a/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/InstancePrinter.xtend
+++ b/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/InstancePrinter.xtend
@@ -360,2 +360 @@
-				«action.printVectorizationConditions»
-					br label %bb_«extName»_fire_notvectorizable
+				«action.printVectorizationConditions(state)»
@@ -407,2 +406,5 @@
-	def protected printVectorizationConditions(Action action) '''
-		«val name = action.name»
+	def protected printVectorizationConditions(Action action, State state) '''
+		«val stateName = if(state != null) '''«state.name»_''' else ""»
+		«val actionName = if(state != null) '''«state.name»_«action.name»''' else '''«action.name»'''»
+		«val portToIndexMap = portToIndexByPatternMap.get(action.inputPattern)»
+		«val connections = action.outputPattern.ports.notNative.map[outgoingPortMap.get(it)].flatten.toList»
@@ -411 +413,8 @@
-«««			%is_«name»_vectorizable_«index» = and i1 %is_«name»_vectorizable_«index-1», %is_«name»_«port.name»_vectorizable
+				«val extName = port.name + "_" + stateName + action.name + "_" + portToIndexMap.get(port)»
+					%tmp_vect1_«extName» = urem i32 %index_«extName», %size_«extName»
+					%tmp_vect2_«extName» = add i32 %index_«extName», «action.inputPattern.numTokensMap.get(port)»
+					%tmp_vect3_«extName» = urem i32 %tmp_vect2_«extName», %size_«extName»
+					%is_vectorizable_«extName» = icmp slt i32 %tmp_vect1_«extName», %tmp_vect3_«extName»
+					br i1 %is_vectorizable_«extName», label %next_vectorizable_«extName», label %bb_«actionName»_fire_notvectorizable
+				
+				next_vectorizable_«extName»:
@@ -413,2 +422,6 @@
-		«ENDFOR»
-		«FOR port : action.outputPattern.ports»
+		«ENDFOR»		
+		«FOR connection : connections»
+			«val port = connection.sourcePort»
+			«val name = port.name + "_" + connection.getSafeId(port)»
+			«val extName = name + "_" + stateName + action.name»
+			«val numTokens = action.outputPattern.numTokensMap.get(port)»
@@ -416 +429,7 @@
-«««			%is_«name»_vectorizable_«index» = and i1 %is_«name»_vectorizable_«index-1», %is_«name»_«port.name»_vectorizable
+					%tmp_vect1_«extName» = urem i32 %index_«extName», %size_«extName»
+					%tmp_vect2_«extName» = add i32 %index_«extName», «numTokens»
+					%tmp_vect3_«extName» = urem i32 %tmp_vect2_«extName», %size_«extName»
+					%is_vectorizable_«extName» = icmp slt i32 %tmp_vect1_«extName», %tmp_vect3_«extName»
+					br i1 %is_vectorizable_«extName», label %next_vectorizable_«extName», label %bb_«actionName»_fire_notvectorizable
+				
+				next_vectorizable_«extName»:
@@ -418,2 +437,2 @@
-		«ENDFOR»
-«««		br i1 %is_vectorizable_«index», label %bb_«name»_fire_vectorizable, label %bb_«name»_fire_notvectorizable
+		«ENDFOR»	
+			br label %bb_«actionName»_fire_vectorizable
@@ -461,2 +480 @@
-				«action.printVectorizationConditions»
-					br label %bb_«name»_fire_notvectorizable
+				«action.printVectorizationConditions(null)»
@@ -503,4 +520,0 @@
-			%tmp_vect1_«extName» = urem i32 %index_«extName», %size_«extName»
-			%tmp_vect2_«extName» = add i32 %index_«extName», %numTokens_«extName»
-			%tmp_vect3_«extName» = urem i32 %tmp_vect2_«extName», %size_«extName»
-			%is_vectorizable_«extName» = icmp slt i32 %tmp_vect1_«extName», %tmp_vect3_«extName»
@@ -517,4 +530,0 @@
-				%tmp_vect1_«pExtName» = urem i32 %index_«pExtName», %size_«pExtName»
-				%tmp_vect2_«pExtName» = add i32 %index_«pExtName», %numTokens_«pExtName»
-				%tmp_vect3_«pExtName» = urem i32 %tmp_vect2_«pExtName», %size_«pExtName»
-				%is_vectorizable_«pExtName» = icmp slt i32 %tmp_vect1_«pExtName», %tmp_vect3_«pExtName»
@@ -540,4 +549,0 @@
-				%tmp_vect1_«extName» = urem i32 %index_«extName», %size_«extName»
-				%tmp_vect2_«extName» = add i32 %index_«extName», «numTokens»
-				%tmp_vect3_«extName» = urem i32 %tmp_vect2_«extName», %size_«extName»
-				%is_vectorizable_«extName» = icmp slt i32 %tmp_vect1_«extName», %tmp_vect3_«extName»
diff --git a/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/LLVMBackend.java b/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/LLVMBackend.java
index 10e873f..09d1803 100644
--- a/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/LLVMBackend.java
+++ b/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/aot/LLVMBackend.java
@@ -207 +207 @@
-		Vectorizable.setVectorizableAttributs(network);
+//		Vectorizable.setVectorizableAttributs(network);
diff --git a/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/tta/SwActorPrinter.xtend b/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/tta/SwActorPrinter.xtend
index 6d7c222..e74e48f 100644
--- a/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/tta/SwActorPrinter.xtend
+++ b/eclipse/plugins/net.sf.orcc.backends/src/net/sf/orcc/backends/llvm/tta/SwActorPrinter.xtend
@@ -84 +84 @@
-				«port.loadVar(incomingPortMap.get(port))»
+				«port.loadVar(incomingPortMap.get(port), action.name)»
@@ -102 +102 @@
-				«port.loadVar(incomingPortMap.get(port))»
+				«port.loadVar(incomingPortMap.get(port), action.name)»
@@ -106 +106 @@
-					«port.loadVar(connection)»
+					«port.loadVar(connection, action.name)»
@@ -116 +116 @@
-				«port.updateVar(connection, action.inputPattern.numTokensMap.get(port))»
+				«port.updateVar(connection, action.inputPattern.numTokensMap.get(port), action.name)»
@@ -120 +120 @@
-					«port.updateVar(connection, action.outputPattern.getNumTokens(port))»
+					«port.updateVar(connection, action.outputPattern.getNumTokens(port), action.name)»


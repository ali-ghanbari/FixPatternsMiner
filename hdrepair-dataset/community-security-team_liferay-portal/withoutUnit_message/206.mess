LPS-18367 with additional bugfixing

LPS-1529 Do the same fix with less code duplication

git-svn-id: svn://svn.liferay.com/repos/public/portal/trunk@25441 05bdf26c-840f-0410-9ced-eb539d925f36


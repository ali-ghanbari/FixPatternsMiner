fix a bug in QueryEncoding

* Currently the recusive function call 'InstantiateFragment(...)' will cause wrong fragmentId, since a query fragment may be called several times.

